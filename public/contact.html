<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The Den — Contact Us</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800;900&display=swap" rel="stylesheet">

  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    :root {
      --bg-dark: #050507;
      --bg-gradient: radial-gradient(circle at top, #1b1b22 0%, #000 100%);
      --text-main: #ffffff;
      --text-muted: rgba(255, 255, 255, 0.7);
      --accent: #ef4444; 
      --glass: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
      --font-body: 'Inter', system-ui, -apple-system, sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    html, body { 
      width: 100%; max-width: 100%; overflow-x: hidden;
      background: var(--bg-gradient);
      color: var(--text-main);
      font-family: var(--font-body);
      line-height: 1.6;
      padding-top: 80px;
    }

    .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
    
    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      background: var(--accent); color: white;
      padding: 12px 24px; border-radius: 99px;
      font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em;
      text-decoration: none; font-size: 11px; border: none; cursor: pointer;
      transition: 0.2s; white-space: nowrap; 
      width: auto;
    }
    .btn:hover { opacity: 0.9; transform: translateY(-1px); }
    
    .btn-outline {
      background: transparent; border: 1px solid var(--glass-border); color: var(--text-muted);
    }
    .btn-outline:hover { border-color: white; color: white; }

    .section-title {
      font-size: 12px; color: var(--accent); letter-spacing: 0.2em;
      text-transform: uppercase; font-weight: 800; margin-bottom: 10px; display: block;
    }
    h2 { font-size: 32px; font-weight: 800; line-height: 1.1; margin-bottom: 20px; }

    header {
      position: fixed; top: 0; width: 100%; z-index: 100;
      background: rgba(0,0,0,0.9); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--glass-border);
    }
    .nav-wrap { display: flex; justify-content: space-between; align-items: center; height: 70px; }
    
    /* Logo Styles */
    .logo { 
      font-weight: 900; font-size: 20px; text-transform: uppercase; 
      letter-spacing: 0.1em; font-style: italic; text-decoration: none; color: white;
    }
    .logo span { color: var(--accent); }
    
    .nav-links { display: flex; gap: 24px; }
    .nav-links a { color: var(--text-muted); text-decoration: none; font-size: 13px; font-weight: 500; text-transform: uppercase; }
    .nav-links a:hover, .nav-links a.active { color: white; }
    
    .mobile-toggle { display: none; cursor: pointer; color: white; }
    
    @media(max-width: 768px) { 
      .nav-links { 
        display: none; 
        position: absolute; top: 70px; left: 0; width: 100%;
        background: #000; flex-direction: column; padding: 20px; border-bottom: 1px solid var(--glass-border);
      }
      .nav-links.open { display: flex; }
      .mobile-toggle { display: block; }
    }

    .contact-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 60px; margin-top: 40px; }
    @media(max-width: 768px) { .contact-grid { grid-template-columns: 1fr; gap: 40px; } }

    .contact-item { display: flex; align-items: flex-start; gap: 16px; margin-bottom: 24px; }
    .contact-icon { color: var(--accent); margin-top: 2px; width: 18px; height: 18px; flex: 0 0 18px; }

    .map-container {
      width: 100%; height: 400px; border-radius: 12px; overflow: hidden;
      border: 1px solid var(--glass-border); position: relative;
      filter: grayscale(100%) invert(88%) brightness(95%) contrast(105%);
    }

    .hours-card { background: var(--glass); border: 1px solid var(--glass-border); padding: 30px; border-radius: 12px; margin-top: 30px; }
    .hour-row { display: flex; justify-content: space-between; border-bottom: 1px solid var(--glass-border); padding: 10px 0; font-size: 14px; }
    .hour-row:last-child { border: none; }

    footer { border-top: 1px solid var(--glass-border); padding: 40px 0; margin-top: 60px; text-align: center; color: var(--text-muted); font-size: 12px; }
  </style>
</head>
<body>

  <div id="nsdBusiness" data-business-id="" style="display:none"></div>

  <header>
    <div class="container nav-wrap">
      <a href="/" class="logo" id="header_logo">THE <span>DEN</span></a>
      
      <div class="mobile-toggle" onclick="toggleMenu()">
        <i data-lucide="menu"></i>
      </div>

      <nav class="nav-links" id="navLinks">
        <a class="nav-link" href="/" data-page="home">Home</a>
        <a class="nav-link" href="/about" data-page="about">About</a>
        <a class="nav-link" href="/services" data-page="services">Services</a>
        <a class="nav-link" href="/gallery" data-page="gallery">Gallery</a>
        <a class="nav-link" href="/team" data-page="team">Team</a>
        <a class="nav-link active" href="/contact" data-page="contact">Contact</a>
      </nav>
      
      <a href="javascript:void(0)" class="btn header-btn" onclick="openBooking(); return false;">Book Now</a>
    </div>
  </header>

  <main class="container">
    <div class="contact-grid">
      <div>
        <span class="section-title" id="contact_kicker">Get In Touch</span>
        <h2 id="contact_heading">Stop By The Shop</h2>
        <p id="contact_text" style="color:var(--text-muted); margin-bottom: 40px;">
          Got a question about a cut? Looking for a specific barber? Drop us a line or pull up to the shop.
        </p>

        <div style="margin-bottom: 40px;">
          <div class="contact-item">
            <i data-lucide="map-pin" class="contact-icon"></i>
            <div>
              <strong style="display:block; margin-bottom:4px;">Location</strong>
              <span id="contact_address" style="color:var(--text-muted); font-size:14px;">
                3904 Bainbridge Blvd<br>Chesapeake, VA 23324
              </span>
            </div>
          </div>
          <div class="contact-item">
            <i data-lucide="phone" class="contact-icon"></i>
            <div>
              <strong style="display:block; margin-bottom:4px;">Phone</strong>
              <a id="contact_phone_link" href="tel:7575432966" style="color:var(--text-muted); font-size:14px; text-decoration: none;">
                <span id="contact_phone_text">(757) 543-2966</span>
              </a>
            </div>
          </div>
        </div>

        <div style="display:flex; flex-direction:column; gap:14px; margin-top:10px;">
          <a id="action_call_btn" href="tel:7575432966" class="btn" style="width:100%">Call The Shop</a>
          <a id="action_text_btn" href="sms:+17575432966" class="btn btn-outline" style="width:100%">Text Us</a>
          <button type="button" class="btn btn-outline" onclick="openBooking(); return false;" style="width:100%">Book An Appointment</button>
          <p style="color:var(--text-muted); font-size:12px; text-align:center; margin-top:10px;">
            Fastest response is call or text. Walk-ins welcome.
          </p>
        </div>

      </div>

      <div>
        <div class="map-container">
          <iframe 
            id="contact_map_frame"
            title="Google Maps Location"
            loading="lazy"
            style="border:0; display:block;" 
            allowfullscreen="" 
            width="100%" 
            height="100%" 
            referrerpolicy="no-referrer-when-downgrade"
            src="">
          </iframe>
        </div>

        <div class="hours-card">
          <h3 style="font-size:16px; text-transform:uppercase; letter-spacing:0.1em; margin-bottom:20px; color:white;">Shop Hours</h3>
          <div id="hours_list">
            <div style="color:var(--text-muted); font-size:13px;">Loading hours...</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div style="font-weight:900; font-size:24px; margin-bottom:10px; text-transform:uppercase; font-style:italic;">THE <span style="color:var(--accent)">DEN</span></div>
      <p>© 2026 The Den Barbershop. Powered by Net Studio.</p>
    </div>
  </footer>

  <script>
    lucide.createIcons();
    
    function toggleMenu() {
      const nav = document.getElementById('navLinks');
      nav.classList.toggle('open');
    }

    window.openBooking = window.openBooking || function () { console.warn("Booking script not yet loaded."); };
    window.closeBooking = window.closeBooking || function () { console.warn("Booking script not yet loaded."); };
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    /* --- CONFIG + SLUG DETECTION (Worker-Ready) --- */
    function nsGetSlugFromHost() {
      // 1) Preview / Pages / local fallback: ?b=slug
      const qp = new URLSearchParams(location.search).get("b");
      if (qp) return String(qp).trim().toLowerCase();

      // 2) Production: slug.netstudiodevelopment.com
      const host = (location.hostname || "").toLowerCase();

      if (!host || host === "localhost" || host.startsWith("127.")) return null;

      // ✅ REMOVED: Legacy .netstudio.app block (Step 2)

      const ROOT = "netstudiodevelopment.com";
      if (host === ROOT || host === "www." + ROOT) return null;

      if (host.endsWith("." + ROOT)) {
        const slug = host.slice(0, -(ROOT.length + 1)).split(".")[0];
        return slug || null;
      }

      return null;
    }

    function nsShouldUseQuerySlug() {
      const host = (location.hostname || "").toLowerCase();
      return (
        host.endsWith(".pages.dev") ||
        host.endsWith(".workers.dev") ||
        host === "localhost" ||
        host.startsWith("127.")
      );
    }

    /* --- INIT CONFIG --- */
    window.NS = window.NS || {
      SUPABASE_URL: "https://jdvdgvolfmvlgyfklbwe.supabase.co",
      SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdmRndm9sZm12bGd5ZmtsYndlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1Mjk5MDgsImV4cCI6MjA3OTEwNTkwOH0.xiAOgWof9En3jbCpY1vrYpj3HD-O6jMHbamIHTSflek",
      BUSINESS_SLUG: nsGetSlugFromHost(),
      TEMPLATE_KEY: "den_v1"
    };

    /* --- NAV REWRITER --- */
    function nsLinkWithSlug(targetPath) {
      const slug = window.NS.BUSINESS_SLUG;
      if (!slug) return targetPath;

      // Production: clean paths, no ?b=
      if (!nsShouldUseQuerySlug()) return targetPath;

      // Preview: keep ?b=slug
      const u = new URL(targetPath, location.origin);
      u.searchParams.set("b", slug);
      return u.pathname + "?" + u.searchParams.toString() + u.hash;
    }

    // ✅ Fixed: Correct Clean URL Logic
    function nsWireHeaderNav() {
      const logo = document.getElementById("header_logo");
      if (logo) logo.setAttribute("href", nsLinkWithSlug("/"));

      document.querySelectorAll("a.nav-link[data-page]").forEach(a => {
        const page = (a.getAttribute("data-page") || "home").toLowerCase();

        // map page key -> route
        const path =
          page === "home" ? "/" :
          page.startsWith("/") ? page :
          "/" + page;

        a.setAttribute("href", nsLinkWithSlug(path));

        // Active state: compare route keys, not filenames
        const current = (location.pathname || "/").replace(/\/+$/, "") || "/";
        const isHome = current === "/";
        const isActive = (page === "home" && isHome) || (page !== "home" && current === path);
        if (isActive) a.classList.add("active");
        else a.classList.remove("active");
      });
    }

    /* --- CONTENT INJECTOR (Contact) --- */
    function applyContactContent(content) {
      const c = (content && content.contact) || {};
      const pick = (...vals) => {
        for (const v of vals) {
          if (v !== undefined && v !== null && String(v).trim() !== "") return v;
        }
        return "";
      };

      const kicker  = pick(c.kicker, "Get In Touch");
      const heading = pick(c.heading, "Stop By The Shop");
      const blurb   = pick(c.blurb, "Got a question about a cut? Looking for a specific barber? Drop us a line or pull up to the shop.");
      const addressHTML = pick(c.address_html, "3904 Bainbridge Blvd<br>Chesapeake, VA 23324");
      const phonePretty = pick(c.phone, "(757) 543-2966");

      const $ = (id) => document.getElementById(id);

      if ($("contact_kicker"))  $("contact_kicker").textContent = kicker;
      if ($("contact_heading")) $("contact_heading").textContent = heading;
      if ($("contact_text"))    $("contact_text").textContent = blurb;

      if ($("contact_address")) {
        $("contact_address").innerHTML = addressHTML; 
      }

      if (phonePretty) {
        const tel = String(phonePretty).replace(/[^\d]/g, "");
        if ($("contact_phone_text")) $("contact_phone_text").textContent = phonePretty;
        if ($("contact_phone_link") && tel) $("contact_phone_link").setAttribute("href", `tel:${tel}`);
        if ($("action_call_btn") && tel) $("action_call_btn").setAttribute("href", `tel:${tel}`);
        
        if ($("action_text_btn") && tel) {
          const smsPrefix = (tel.length === 11 && tel.startsWith("1")) ? "+" : "+1";
          $("action_text_btn").setAttribute("href", `sms:${smsPrefix}${tel}`); 
        }
      }

      const mapQ = pick(c.map_q, content.map_q, ""); 
      if (mapQ && $("contact_map_frame")) {
        $("contact_map_frame").src = `https://maps.google.com/maps?q=${encodeURIComponent(mapQ)}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
      }
    }

    /* --- HOURS LOGIC --- */
    function nsDayOrder(d){
      const m = { monday: 1, tuesday: 2, wednesday: 3, thursday: 4, friday: 5, saturday: 6, sunday: 7 };
      return m[String(d || "").toLowerCase()] || 99;
    }

    function nsFmtTime(t){
      if (!t) return "";
      const parts = String(t).split(":");
      const hh = parseInt(parts[0] || "0", 10);
      const mm = parts[1] || "00";
      const ampm = hh >= 12 ? "PM" : "AM";
      const h12 = ((hh + 11) % 12) + 1;
      return `${h12}:${mm} ${ampm}`;
    }

    function nsDayLabel(d){
      const x = String(d || "").toLowerCase();
      return x ? x.charAt(0).toUpperCase() + x.slice(1) : "";
    }

    function renderHoursFromRows(rows){
      const el = document.getElementById("hours_list");
      if (!el || !rows || !rows.length) {
        if (el) el.innerHTML = `<div style="color:rgba(255,255,255,0.4)">Hours not available</div>`;
        return;
      }

      const sorted = [...rows].sort((a,b) => nsDayOrder(a.day_of_week) - nsDayOrder(b.day_of_week));

      el.innerHTML = sorted.map(r => {
        const day = nsDayLabel(r.day_of_week);
        const closed = !!r.is_closed || !r.open_time || !r.close_time;
        const time = closed ? "Closed" : `${nsFmtTime(r.open_time)} - ${nsFmtTime(r.close_time)}`;

        return `
          <div class="hour-row">
            <span style="color:${closed ? "var(--accent)" : "var(--text-muted)"}">
              ${day}
            </span>
            <span ${closed ? `style="color:var(--accent); font-weight:700"` : ""}>
              ${time}
            </span>
          </div>
        `;
      }).join("");
    }

    /* --- INIT --- */
    (async () => {
      try {
        nsWireHeaderNav();

        if (!NS.BUSINESS_SLUG) {
           console.warn("No slug found");
           return;
        }

        if (typeof window.supabase === "undefined" || !window.supabase.createClient) {
          console.error("Supabase CDN failed to load.");
          return;
        }

        const sb = supabase.createClient(NS.SUPABASE_URL, NS.SUPABASE_ANON_KEY);

        // 1. Get Business ID
        const { data: biz, error } = await sb
          .from("business")
          .select("id")
          .eq("slug", NS.BUSINESS_SLUG)
          .maybeSingle();

        if (error || !biz?.id) return;

        document.getElementById("nsdBusiness")?.setAttribute("data-business-id", biz.id);
        document.body.dataset.businessId = biz.id;

        // 2. Load Hours (Parallel for speed)
        const [hoursRes, siteRes] = await Promise.all([
          sb.from("business_hours").select("day_of_week, open_time, close_time, is_closed").eq("business_id", biz.id),
          sb.from("business_sites").select("content_json").eq("business_id", biz.id).eq("template_key", NS.TEMPLATE_KEY).maybeSingle()
        ]);

        renderHoursFromRows(hoursRes.data || []);

        // 3. Load Content (Contact Info)
        const content = siteRes.data?.content_json || {};
        applyContactContent(content);

      } catch (e) {
        console.error("Page Load Error:", e);
      }
    })();
  </script>
  <script src="/assets/js/netstudio_booking.js"></script>

</body>
</html>
